Resources:
  #  DynamoDB tables
  SymptomLogsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: SymptomLogs_Iac
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH

  EnvCacheTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: EnvCache_Iac
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: city
          AttributeType: S
      KeySchema:
        - AttributeName: city
          KeyType: HASH

  # SQS queue
  SymptomQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: SymptomQueue_Iac

  # IAM roles 
  LambdaExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: eczema-backend-lambda-role-iac
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - lambda.amazonaws.com
            Action:
              - sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess


  ApiGatewayRestApi:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Name: EczemaBackendApi_Iac

Outputs:
  ApiId:
    Value: !Ref ApiGatewayRestApi
    Export:
      Name: EczemaBackendApiId

